# Добавление тестов в проект

## Требования к системе

- [Git LFS](https://git-lfs.github.com)
- [Node.js](https://nodejs.org/en/) минимум 10 версии
- [Yarn](https://yarnpkg.com/lang/en/docs/install/)

## Добавление тестов

1. Перейти в папку проекта `cd ./some-project`.
1. Скачать e2e-tools.
1. Выполнить первичную инициализацию `npx -p @csssr/e2e-tools et init`.
1. Перейти в сгенерированную папку `cd e2e-tests/`.
1. Добавить Nightwatch `yarn et add-tool @csssr/e2e-tools-nightwatch`.
1. Проверить, что тесты запускаются `yarn et nightwatch:run`.
1. Изолировать папку `e2e-tests/` от остального проекта: добавить её в `.eslintignore`, `.prettierignore`, в `coverageIgnore` в конфиге jest и т. д.
1. Настроить Jenkins [↓](https://github.com/csssr-team/e2e-tools/blobmaster/docs/SETUP.md#настройка-дженкинса).
 
После добавления тестов необходимо решить следующие организационные вопросы:
- Попросить всех разработчиков установить себе [Git LFS](https://git-lfs.github.com)
- Попросить всех разработчиков прочитать [документацию к данной библиотеке e2e тестов](https://github.com/CSSSR/e2e-tools/tree/master/docs).
- Дать доступ на чтение к репозиторию команде [QA (e2e)](https://github.com/orgs/CSSSR/teams/qa-e2e/repositories), чтобы QA было легче делиться с друг другом наработками.
- Включить автоудаление веток после мёржа PR в настройках репозитория и удалить старые ветки, чтобы сканирование веток в Jenkins проходило быстрее.

## Настройка Jenkins

Настройкой Jenkins для e2e занимаются девопсы. Поэтому необходимо отправить просьбу в #servers о создании джобы для запуска сервера. В просьбе необходимо указать:

- Ссылку на [инструкцию для devops](./SETUP_JENKINS.md)
- Название проекта в формате «слова, разделённые дефисами» (например, csssr-com)
- Читаемое название проекта (например, «CSSSR — основной сайт»)
- Список людей, которым нужен доступ к запуску тестов (и прочим сборкам проекта в Jenkins)
- Ссылку на репозиторий

Шаблон:

```
@devops
Привет! Создайте, пожалуйста, Jenkins-джобу для запуска e2e тестов.

– Инструкция: https://github.com/csssr-team/e2e-tools/blob/master/docs/SETUP_JENKINS.md
– Машиночитаемое название проекта:
– Человекочитаемое название проекта:
– Доступ понадобится:
– Репозиторий:
```

## Обновление e2e-tools и e2e-tools-nightwatch

Чтобы обновить пакеты до последней версии и исправить файлы в проекте, выполните `yarn et upgrade`. После выполнения нужно проверить, что всё работает, закоммитить и запустить тесты в Jenkins.

### Версионирование

Major: Ломающие изменения.
Minor: Ломающие изменения, которые можно автоматически исправить командой `yarn et upgrade`.
Patch: Неломающие изменения.
