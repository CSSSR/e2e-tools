# Добавление тестов в проект

## Требования к системе
- Установленный [Git LFS](https://git-lfs.github.com)
- [Node.js](https://nodejs.org/en/) минимум 10 версии
- [Yarn](https://yarnpkg.com/lang/en/docs/install/)

## Добавление тестов
1. Переходим в папку проекта `cd ./some-project`
1. Скачиваем e2e-tools и выполняем первичную инициализацию `npx -p @nitive/e2e-tools et init`
1. Переходим в сгенерированную папку `cd e2e-tests/`
1. Добавляем Nightwatch `yarn et add-tool @nitive/e2e-tools-nightwatch`
1. Проверяем, что тесты запускаются `yarn et nightwatch:run`
1. Изолируем папку `e2e-tests/` от остального проекта: добавляем её в .eslintignore, .prettierignore, в `coverageIgnore` в конфиге jest и т. д.
1. Настраиваем дженкинс ↓

### Настройка дженкинса
Простой способ: просим в #servers создать джобу для запуска сервера, даём ссылку на эту инструкцию.
Сложный способ: делаем всё сами

1. Получаем в #servers права на создание джобов в дженкинсе
1. Получаем в #servers права на просмотр джобов, которые начинаются с определённого префикса (с которым будет создаваться джоба). Обычно этот префикс — название проекта.
1. Создаём multibranch pipeline [в дженкинсе](https://jenkins.csssr.ru/view/all/newJob), называем с префиксом с предыдущего шага
1. В последнем поле «Copy from» указываем professionals-nightwatch-e2e, нажимаем OK
1. Меняем Display Name и Repository HTTPS URL, сохраняем
1. Тесты для master должены запуститься автоматически
1. Запрашиваем доступы в дженкинс и к этой джобе для всей команды

## Обновление e2e-tools и e2e-tools-nightwatch
Есть специальная команда `yarn et upgrade`, которая обновляет пакеты до последней версии
и автоматически фиксит файлы в проекте. После её прогона нужно проверить, что всё работает,
закоммитить и запустить тесты в дженкинсе.

### Версионирование
Major: Ломающие изменения  
Minor: Ломающие изменения, которые можно автоматически пофиксить командой `yarn et upgrade`  
Patch: Неломающие изменения
