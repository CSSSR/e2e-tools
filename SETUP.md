# Добавление тестов в проект

## Требования к системе

- Установленный [Git LFS](https://git-lfs.github.com)
- [Node.js](https://nodejs.org/en/) минимум 10 версии
- [Yarn](https://yarnpkg.com/lang/en/docs/install/)

## Добавление тестов

1. Переходим в папку проекта `cd ./some-project`
1. Скачиваем e2e-tools и выполняем первичную инициализацию `npx -p @csssr/e2e-tools et init`
1. Переходим в сгенерированную папку `cd e2e-tests/`
1. Добавляем Nightwatch `yarn et add-tool @csssr/e2e-tools-nightwatch`
1. Проверяем, что тесты запускаются `yarn et nightwatch:run`
1. Изолируем папку `e2e-tests/` от остального проекта: добавляем её в `.eslintignore`, `.prettierignore`, в `coverageIgnore` в конфиге jest и т. д.
1. Настраиваем дженкинс ↓

### Настройка дженкинса

#### Инструкция для разработчиков

Просим в #servers создать джобу для запуска сервера, прикладываем

- Ссылку на [инструкцию для devops](https://github.com/csssr-team/e2e-tools/blob/master/SETUP_JENKINS.md)
- Название проекта в формате «слова, разделённые дефисами» (например, csssr-store)
- Читаемое название проекта (например, CSSSR.store)
- Список людей, которым нужен доступ к запуску тестов (и прочим сборкам проекта в дженкинсе)
- Ссылку на репозиторий

Вот готовый шаблон, который можно скопировать и заполнить:

```
@qtm @Anton Rogozin
Привет! Создайте, пожалуйста, дженкинс джобу для запуска e2e тестов

– Инструкция: https://github.com/csssr-team/e2e-tools/blob/master/SETUP_JENKINS.md
– Машиночитаемое название проекта:
– Человекочитаемое название проекта:
– Доступ понадобится:
– Репозиторий:
```

## Обновление e2e-tools и e2e-tools-nightwatch

Есть специальная команда `yarn et upgrade`, которая обновляет пакеты до последней версии
и автоматически фиксит файлы в проекте. После её прогона нужно проверить, что всё работает,
закоммитить и запустить тесты в дженкинсе.

### Версионирование

Major: Ломающие изменения  
Minor: Ломающие изменения, которые можно автоматически пофиксить командой `yarn et upgrade`  
Patch: Неломающие изменения
